# 4ndr0serviceguard

**An operational tool for browser-level manipulation, designed to neutralize client-side Service Worker defenses and expose underlying application logic.**

`4ndr0serviceguard` is a tactical browser extension for Red Team operators and penetration testers. It provides surgical control over a target's Service Worker environment, allowing you to systematically dismantle a common layer of client-side security and application logic. By neutralizing the Service Worker API, you can unmask hidden endpoints, bypass client-side validation, and force applications into legacy fallback modes, significantly expanding the attack surface observable from your intercepting proxy.

---

## Core Capabilities

- **Default-Deny SW Policy:** Implements a global block on all Service Worker registrations, ensuring no target can establish client-side persistence or request proxies without explicit operator approval.
- **Stealthy API Nullification:** Pacifies the Service Worker API by resolving promises with fake registration objects, deceiving application logic and avoiding explicit failures that could alter application behavior or trigger defensive alerts.
- **Surgical Target Enablement:** Utilizes a whitelist to selectively enable Service Workers only for domains under active analysis, reducing operational noise from non-target tabs.
- **Zero-Day Race Condition Dominance:** Executes neutralization code in the `MAIN` world context at `document_start`, guaranteeing execution before any target scripts and ensuring complete control of the Service Worker API from the moment of instantiation.

---

## Red Team Operational Scenarios

`4ndr0serviceguard` is an instrument of control, designed to manipulate the client-side environment to reveal deeper vulnerabilities.

### Scenario 1: Bypassing Client-Side Validation & Controls

Modern web apps use Service Workers as a client-side firewall to validate or sanitize data *before* it is sent to the backend API. Disabling this layer allows you to send raw, malformed data directly to the API endpoint.

1.  **Target:** A sophisticated SPA (`secure-bank.com`) that uses a Service Worker to encrypt payloads or add anti-CSRF tokens.
2.  **Tactic:** Ensure `secure-bank.com` is **not** on the whitelist. `4ndr0serviceguard` will nullify the Service Worker.
3.  **Execution:** The application's frontend logic, now stripped of its client-side protection, sends raw data to the API.
4.  **Result:** Your intercepting proxy (Burp Suite / ZAP) now sees the unobscured API requests. You can now test for injection vulnerabilities, parameter tampering, and broken access control that the Service Worker would have otherwise prevented.

### Scenario 2: De-cloaking Obfuscated API Endpoints

Applications may use Service Workers to dynamically construct API request paths or proxy them through a single gateway, hiding the true backend architecture from observers.

1.  **Target:** A media-heavy application (`content-delivery.net`) that fetches assets from URLs generated by its Service Worker.
2.  **Tactic:** Disable the Service Worker via `4ndr0serviceguard`.
3.  **Execution:** The application, unable to communicate with its Service Worker, may fall back to making direct requests for assets or data.
4.  **Result:** The true API endpoints and backend storage URLs are revealed in your proxy's traffic log, providing new targets for enumeration and attack.

### Scenario 3: Uncovering Vulnerabilities in Legacy Fallback Modes

Developers often leave legacy code paths in place for browsers that don't support Service Workers. By disabling the SW, you can force the application into these often less-tested and less-secure states.

1.  **Target:** A modern PWA (`shiny-app.io`) with a complex Service Worker architecture.
2.  **Tactic:** Nullify the Service Worker.
3.  **Execution:** The application fails to initialize its primary PWA logic and reverts to a simpler, perhaps older, version of the application.
4.  **Result:** You are now interacting with a different attack surface, potentially discovering older, unpatched vulnerabilities (e.g., XSS, insecure direct object references) that are masked during normal operation.

---

## Tactical Deployment

This tool is loaded as an unpacked extension for maximum control and to avoid web store policies.

1.  Clone this repository: `git clone <repo_url>`
2.  Navigate to `chrome://extensions` in a Chromium-based browser.
3.  Enable **"Developer mode"**.
4.  Click **"Load unpacked"** and select the repository's root directory.
5.  The extension is now active. Its default-deny policy is immediately enforced.

**To manage target scope:**

1.  Click the extension icon to open the control panel.
2.  Use the master toggle to activate or deactivate the tool globally.
3.  To enable Service Workers for a specific target, add its domain (e.g., `example.com`) to the whitelist. One domain per line. Reload the target tab to apply.

---

## Mechanism of Action (MoA)

`4ndr0serviceguard` achieves its objective through a direct and robust mechanism:

1.  **`MAIN` World Injection:** The `pacifier.js` content script is injected directly into the page's `MAIN` world context, providing it with the same level of privilege as the target application's own scripts.
2.  **API Monkey-Patching:** Executing at `document_start`, it immediately saves a reference to the original `navigator.serviceWorker` methods and then overwrites them.
3.  **Deceptive Resolution:** The overridden `register` method returns a resolved `Promise` containing a fake `ServiceWorkerRegistration` object. This deceives the application into believing its Service Worker is active, preventing it from crashing or altering its behavior in response to a hard failure.
4.  **Surgical Restoration:** For whitelisted domains, the `background.js` script uses `chrome.scripting.executeScript` to reinject the original, saved `navigator.serviceWorker` methods, restoring full functionality for analysis.

---

## Customization for Engagements

As there are no external dependencies or build steps, the JavaScript source can be modified directly to suit engagement needs. After editing, navigate to `chrome://extensions` and reload the extension.

---

## License

This project is licensed under the MIT License.
